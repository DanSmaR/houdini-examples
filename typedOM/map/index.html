<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
  <title>Pin on a Map | Typed OM Houdini Demos</title>
  <meta name="description" content="Demonstration for Mozilla Developer Network using Houdini Typed OM API. An interactive map with the ability to add pins.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="map.css">

  <style type="text/css">

  </style>

</head>
<body>

	<article>
		<header>
			<h2>My Travels</h2>
		</header>

		<div class="map">
			<figure class="map__image">
				<img src="world-map.jpg" alt="A picture of the map of the world" />
				<figcaption>Image from: https://mapswire.com/world/physical-maps/</figcaption>
			</figure>
		</div>
	</article>

<script type="text/javascript">

	const mapEl = document.querySelector('.map');
	console.log(mapEl.getBoundingClientRect().x);

	mapEl.addEventListener('click', function(e) {

		// create marker with image and position
		const marker = {};
		marker.img = document.createElement('img');
		marker.img.src = 'marker.svg';
		marker.img.alt = 'Map marker';
		marker.img.classList.add('marker');

		// there are two ways we can create css ps value
		// marker.bottom = new CSSUnitValue(e.clientY - mapEl.getBoundingClientRect().y, 'px')
		// marker.top = Math.round(e.clientY - mapEl.getBoundingClientRect().y - 31);
		// or
		// marker.left = CSS.px(e.clientX - mapEl.getBoundingClientRect().x - 15);
		// marker.left = Math.round(e.clientX - mapEl.getBoundingClientRect().x - 18);

		// notice how we can use numbers

		// can you add a map to set()?
		// marker.img.attributeStyleMap.set('top', new CSSUnitValue(marker.top, 'px'));
		// marker.img.attributeStyleMap.set('left', CSS.px(marker.left));

		// but what if we resize the browser
		// we know our area is 100vw by 50vw so we can use that to our advantage, as they are responsive units. We just need to work out how much one vw is at time of click and convert from our pixel placement to vw instead
		// this should be easy with typed om

		// find 1vw based on screen size over 100
		const vw = window.innerWidth/100;
		console.log(vw);

		// divide our pixel value by this to get vw
		// marker.top = (Math.round(e.clientY - mapEl.getBoundingClientRect().y - 31)) / vw;
		// or
		// marker.left = CSS.px(e.clientX - mapEl.getBoundingClientRect().x - 15);
		// marker.left = (Math.round(e.clientX - mapEl.getBoundingClientRect().x - 18)) / vw;
		// use this knew value instead

		// let's make a unit converter and change our pixel values to percentage values

		marker.top = new CSSUnitValue(e.clientY - mapEl.getBoundingClientRect().y, 'px')
		marker.left = CSS.px(e.clientX - mapEl.getBoundingClientRect().x - 15);

		marker.topvw = marker.top.to('percent');
		marker.leftvw = marker.left.to('percent');

		marker.img.attributeStyleMap.set('top', marker.topvw);
		marker.img.attributeStyleMap.set('left', marker.leftvw);

		mapEl.appendChild(marker.img);

	}, false)

</script>

</body>
</html>